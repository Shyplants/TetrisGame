#pragma once

#include "TetrisTypes.h"
#include "SimpleMath.h"
#include <array>

namespace TetrisRules
{
	using DirectX::SimpleMath::Vector2;

	// 각 미노의 4개 블록 상대좌표 (각 회전마다 4개 블록)
	static constexpr std::array<std::array<std::array<DirectX::SimpleMath::Vector2, MINO_COUNT>, ROTATION_COUNT>, MINO_TYPE_COUNT> 
	Shapes = {{
		/* I */
		{{
			{{{-1,+0},{+0,+0},{+1,+0},{+2,+0}}}, /* R0 */
			{{{+0,-2},{+0,-1},{+0,+0},{+0,+1}}}, /* R90 */
			{{{-2,+0},{-1,+0},{+0,+0},{+1,+0}}}, /* R180 */
			{{{+0,-1},{+0,+0},{+0,+1},{+0,+2}}}, /* R270 */
		}},

		/* O */
		{{
			{{{+0,+0},{+1,+0},{+0,+1},{+1,+1}}}, /* R0 */
			{{{+0,-1},{+1,-1},{+0,+0},{+1,+0}}}, /* R90 */
			{{{-1,-1},{+0,-1},{-1,+0},{+0,+0}}}, /* R180 */
			{{{-1,+0},{+0,+0},{-1,+1},{+0,+1}}}, /* R270 */
		}},

		/* T */
		{{
			{{{-1,+0},{+0,+0},{+1,+0},{+0,+1}}}, /* R0 */
			{{{+0,-1},{+0,+0},{+1,+0},{+0,+1}}}, /* R90 */
			{{{+0,-1},{-1,+0},{+0,+0},{+1,+0}}}, /* R180 */
			{{{+0,-1},{-1,+0},{+0,+0},{+0,+1}}}, /* R270 */
		}},

		/* L */
		{{
			{{{-1,+0},{+0,+0},{+1,+0},{+1,+1}}}, /* R0 */
			{{{+0,-1},{+1,-1},{+0,+0},{+0,+1}}}, /* R90 */
			{{{-1,-1},{-1,+0},{+0,+0},{+1,+0}}}, /* R180 */
			{{{+0,-1},{+0,+0},{-1,+1},{+0,+1}}}, /* R270 */
		}},

		/* J */
		{{
			{{{-1,+0},{+0,+0},{+1,+0},{-1,+1}}}, /* R0 */
			{{{+0,-1},{+0,+0},{+0,+1},{+1,+1}}}, /* R90 */
			{{{+1,-1},{-1,+0},{+0,+0},{+1,+0}}}, /* R180 */
			{{{-1,-1},{+0,-1},{+0,+0},{+0,+1}}}, /* R270 */
		}},

		/* S */
		{{
			{{{-1,+0},{+0,+0},{+0,+1},{+1,+1}}}, /* R0 */
			{{{+1,-1},{+0,+0},{+1,+0},{+0,+1}}}, /* R90 */
			{{{-1,-1},{+0,-1},{+0,+0},{+1,+0}}}, /* R180 */
			{{{+0,-1},{-1,+0},{+0,+0},{-1,+1}}}, /* R270 */
		}},

		/* Z */
		{{
			{{{+0,+0},{+1,+0},{-1,+1},{+0,+1}}}, /* R0 */
			{{{+0,-1},{+0,+0},{+1,+0},{+1,+1}}}, /* R90 */
			{{{+0,-1},{+1,-1},{-1,+0},{+0,+0}}}, /* R180 */
			{{{-1,-1},{-1,+0},{+0,+0},{+0,+1}}}, /* R270 */
		}},
	}};

	static constexpr std::array<std::array< DirectX::SimpleMath::Vector2, JLSTZ_OFFSET_COUNT>, ROTATION_COUNT> 
	JLSTZ_Offset_Data = {{
		{{
			{+0, +0}, {+0, +0}, {+0, +0}, {+0, +0}, {+0, +0},
		}},
		{{
			{+0, +0}, {+1, +0}, {+1, -1}, {+0, +2}, {+1, +2},
		}},
		{{
			{+0, +0}, {+0, +0}, {+0, +0}, {+0, +0}, {+0, +0},
		}},
		{{
			{+0, +0}, {-1, +0}, {-1, -1}, {+0, +2}, {-1, +2},
		}},
	}};

	static constexpr std::array<std::array< DirectX::SimpleMath::Vector2, I_OFFSET_COUNT>, ROTATION_COUNT> 
	I_Offset_Data = {{
		{{
			{+0, +0}, {-1, +0}, {+2, +0}, {-1, +0}, {+2, +0},
		}},
		{{
			{-1, +0}, {+0, +0}, {+0, +0}, {+0, +1}, {+0, -2},
		}},
		{{
			{-1, +1}, {+1, +1}, {-2, +1}, {+1, +0}, {-2, +0},
		}},
		{{
			{+0, +1}, {+0, +1}, {+0, +1}, {+0, -1}, {+0, +2},
		}},
	}};

	static constexpr std::array<std::array< DirectX::SimpleMath::Vector2, O_OFFSET_COUNT>, ROTATION_COUNT> 
	O_Offset_Data = {{
		{{
			{+0, +0},
		}},
		{{
			{+0, -1},
		}},
		{{
			{-1, -1},
		}},
		{{
			{-1, +0},
		}},
	}};

	static std::array<Vector2, MINO_COUNT> GetShapeBlocks(TetrominoType type, Rotation rot)
	{
		if (type == TetrominoType::None)
			return {};

		size_t typeIndex = static_cast<size_t>(type) - 1;
		size_t rotIndex = static_cast<size_t>(rot);

		return Shapes[typeIndex][rotIndex];
	}
}